{"title":"How to convert images to AVIF in NodeJS","date":"September 7, 2020","url":"/blog/how-to-convert-images-to-avif-in-nodejs","author":"Adam LaCombe","twitter":"adamlacombe","description":"AVIF is the latest next-gen image compression format. Learn how to convert images to AVIF using the Sharp library.","tags":["AVIF","NodeJS","Sharp"],"img":"/assets/blog/images/how-to-convert-images-to-avif-in-nodejs/main.png","srcPath":"./src/blog/how-to-convert-images-to-avif-in-nodejs.md","hypertext":["div",null,["h2",{"id":"what-is-avif-and-why-should-i-be-using-it"},"What is AVIF and why should I be using it?"],"\n",["p",null,"AVIF is the latest next-gen image compression format. It offers significant file size reduction for images compared with JPEG ( ~50% ) or WebP ( ~20% ). Chrome recently shipped support for ",["a",{"href":"https://www.chromestatus.com/feature/4905307790639104#status"},"AVIF in Chrome 85"]," and it can be enabled in ",["a",{"href":"https://bugzilla.mozilla.org/show_bug.cgi?id=1443863"},"Firefox"]," via the ",["code",null,"image.avif.enabled"]," flag in ",["code",null,"about:config"],"."],"\n",["p",null,"Take a look at this ",["a",{"href":"https://netflixtechblog.com/avif-for-next-generation-image-coding-b1d75675fe4"},"blog post"]," published by ",["strong",null,"Netflix"]," if you're looking for a more in-depth comparison."],"\n",["h2",{"id":"how-can-i-convert-my-images-to-avif"},"How can I convert my images to AVIF?"],"\n",["p",null,["a",{"href":"https://squoosh.app/"},"Squoosh"]," recently ",["a",{"href":"https://github.com/GoogleChromeLabs/squoosh/pull/722"},"shipped support"]," for AVIF if you don't mind manually converting your images."],"\n",["p",null,"If you're looking for a more automated method, you could try using ",["a",{"href":"https://github.com/lovell/sharp"},"Sharp"],". \nSharp offers ",["a",{"href":"https://sharp.pixelplumbing.com/api-output#heif"},"support for AVIF"]," although it is currently experimental. "],"\n",["p",null,"Unfortunately, Sharp's prebuilt binaries do not support AVIF, so you will have to compile ",["code",null,"libvips"]," with support for ",["code",null,"libheif"]," before you can start taking advantage of this \"experimental\" feature."],"\n",["p",null,"To simplify this process I created a ",["a",{"href":"https://github.com/adamlacombe/sharp-image-proxy/blob/master/Dockerfile"},"Dockerfile"]," that I'm using in ",["a",{"href":"https://github.com/adamlacombe/sharp-image-proxy"},"sharp-image-proxy"],"."],"\n",["p",null,["repo-card",{"name":"adamlacombe/sharp-image-proxy"}]],"\n",["p",null,"If you aren't familiar with Docker, I suggest you read my post: ",["a",{"href":"/blog/introduction-to-docker"},"Introduction to Docker"],"."],"\n",["p",null,"Once you have ",["code",null,"libvips"]," installed and compiled with support for ",["code",null,"libheif"]," you can start using the Sharp API. "],"\n",["p",null,"Here's an example of how you can convert a png to avif:"],"\n\n  ",["highlight-code",{"language":"typescript"},"\n    ",["pre",{"class":"language-typescript"},["code",{"class":"language-typescript"},["span",{"class":"token keyword"},"import"]," ",["span",{"class":"token operator"},"*"]," ",["span",{"class":"token keyword"},"as"]," sharp ",["span",{"class":"token keyword"},"from"]," ",["span",{"class":"token string"},"'sharp'"],["span",{"class":"token punctuation"},";"],"\n\n",["span",{"class":"token function"},"sharp"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'input.png'"],["span",{"class":"token punctuation"},")"],"\n  ",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"toFormat"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'heif'"],["span",{"class":"token punctuation"},","]," ",["span",{"class":"token punctuation"},"{"]," quality",["span",{"class":"token operator"},":"]," ",["span",{"class":"token number"},"30"],["span",{"class":"token punctuation"},","]," compression",["span",{"class":"token operator"},":"]," ",["span",{"class":"token string"},"'av1'"]," ",["span",{"class":"token punctuation"},"}"],["span",{"class":"token punctuation"},")"],"\n  ",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"toFile"],["span",{"class":"token punctuation"},"("],["span",{"class":"token string"},"'output.avif'"],["span",{"class":"token punctuation"},")"],"\n  ",["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"then"],["span",{"class":"token punctuation"},"("],"info ",["span",{"class":"token operator"},"=>"]," ",["span",{"class":"token builtin"},"console"],["span",{"class":"token punctuation"},"."],["span",{"class":"token function"},"log"],["span",{"class":"token punctuation"},"("],"info",["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},")"],["span",{"class":"token punctuation"},";"]]],"\n  "]]}